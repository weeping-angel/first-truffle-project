# Truffle

Truffle is a framework that is used for the development, deployment and testing of the smart contracts.

It is used for for their:

    - Compilation
    - Deployment
    - Testing

## Installtion

To install the truffle suite, NodeJS must me installed on the system.

Run the following command to install the truffle globally:

```console
npm install -g truffle
```

To check whether it's installed successfully or not, check its version:

```console
truffle version
```

## First Project

To initialize a project, run:

```console
truffle init
```

This will create the following directory structure:

```
.
├── contracts
│   └── Migrations.sol
├── migrations
│   └── 1_initial_migration.js
├── test
└── truffle-config.js
```

1. `contracts`: Folder where we will write contracts in solidity files. By default, it contains `Migrations.sol` file generated by the truffle.

2. `migrations`: Folder where we'll write the deployment scripts and other migration stuff (usually in .js files). As the convention, filename must start with a number, so the migrations can be done orderly.

3. `test`: Folder where we'll write the testcases for the smart contract(s). These can we written in solidity and javascript (usually).

4. `truffle-config.js`: File which contains all the configurations such as chain details, export details, private key, etc ...

## Compilation

Once you've written your code in `contracts` folder, you can run the following command to create artifacts in the `build` folder (generated automatically).

```console
truffle compile
```

```
build
└── contracts
    └── <json_files>
```

Artifacts (JSON files) contain ABI, bytecode, metadata, compiler info, network detail, etc... They get update every time we compile new changes to the contract or deploy them.

Here, I've created `SampleContract` inside "SampleContract.sol" file, containing 2 functions: _setData_ and _getData_.

This will generate **./build/contracts/SampleContract.json** after compilation.

## Testing

Smart contracts cannot be changed once they're deployed. Hence their rigorous testing is crucial. 

Testing is done using `moca`

```console
truffle test
```

Here, I've written `SampleContractTest.js` file to see if it's setting and getting the data value properly.

## Deployment

In truffle project, we write the deployment script in `migrations` folder. 

Here, I've written `2_deploy_contracts.js` file.

### On local chain

To start the local built-in development chain, Ganache, run:

```console
truffle develop
```

This will start a new prompt, where you can run the deployment command:

```console
> migrate --reset
```

### On public testnet

1. Get the cryptocurrency from the faucet on one of your wallet address. For example, go to [This Faucet](https://testnet.binance.org/faucet-smart) for getting BNB on BSC Testnet.

2. Install `hdwallet-provider` using following command:

```console
npm install @truffle/hdwallet-provider
```

3. Add these two line in `truffle-config.js` at the beginning:

```javascript
const HDWalletProvider = require('@truffle/hdwallet-provider');
const privateKeys = ['0x + YOUR_PRIVATE_KEY'];
```

4. Add the network details in the "networks" section. (For RPC chain URL, see [this page](https://docs.binance.org/smart-chain/developer/rpc.html)):

```javascript
"networks": {
    bscTestnet: {
        provider: () => new HDWalletProvider(
            privateKeys,
            'https://data-seed-prebsc-1-s1.binance.org:8545/'
        ),
        network_id: 97,
        skipDryRun: true,
    }
}
```

5. For deploying to the public testnet (here _bscTestnet_) or mainnet, run:

```console
truffle migrate --reset --network bscTestnet
```

## Interacting with the contract

### Using console
```console
truffle console --network <network>
```

This will start a prompt where you can run the javascript code like following:

```javascript
contract = await ContractName.deployed()
contract.address
```

